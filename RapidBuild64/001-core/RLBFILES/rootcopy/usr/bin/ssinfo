#!/bin/bash
# A script to scrape the system and output
# a text file on the desktop with sysinfo

tmp=/tmp/ssinfo.txt

# Set vars
touch $tmp

# Get user info
user=$(whoami)
osdrive=$(ls /mnt/live/mnt)
kernel=$(uname -r)
machine=$(uname -m)
parts=$(cat /proc/partitions | grep "[hs]d.[1-9]*" | awk '{print$4}')
optical=$(cat /proc/sys/dev/cdrom/info | grep name | awk '{print$3}')
removable=$(cat /proc/scsi/usb-storage/* | grep Product | awk '{print$2}')
mounted=$(df -Th | grep dev)
processor=$(uname -p)
cfg=$(cat /proc/cmdline)
ram=$(fgrep Mem /proc/meminfo)
soundcard=$(cat /proc/asound/cards)
network=$(ifconfig)
ns=$(cat /etc/resolv.conf)
usb=$(lsusb)
pci=$(lspci)
modules=$(ls /mnt/live/memory/modules)
dmes=$(dmesg | tail )
logs=$(cat /var/log/messages | tail)
usblock=$(cat /var/log/messages | grep Protect | awk '{print$8$9$10$12}')
soundriver=$(cat /proc/asound/version)
screen=$(xrandr | grep Screen)

cat << EOF > $tmp
----------------------
Output from ssinfo
----------------------
script by jayflood
.
.

====== USER INFO =====
User is: $user
.
===== MACHINE INFO =====
Platform: $machine
Kernel: $kernel
Processor: $processor
$ram
Bootparam: $cfg
.
===== SOUND INFO =====
Sound card: $soundcard
Sound driver: $soundriver
.
===== PARTITION INFO =====
Slax is on: /mnt/$osdrive
.
Partitions: 
$parts
.
Mounted: 
$mounted
.
===== OPTICAl DRIVE =====
$optical
.
===== USB INFO =====
Removables: $removable
Removable status: $usblock
.
lsusb: $usb
.
===== SCREEN INFO =====
$screen
.
===== MODULES LOADED =====
$modules
.
===== NETWORK INFO =====
$network
.
$ns
.
===== PCI INFO =====
lspci: $pci
.
.
===== LOGS INFO =====
dmesg | tail 
.
$dmes
.
.
cat /var/log/messages | tail
.
$logs
..
EOF
cp $tmp ~/Desktop/ssinfo.txt
rm -f $tmp
exit
